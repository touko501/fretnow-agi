<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- CSP managed by server -->
<meta name="referrer" content="no-referrer">
<meta name="robots" content="noindex, nofollow">
<title>FRETNOW ‚Äî Espace Chargeur</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700;9..40,800;9..40,900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#F7F7F5;--surface:#FFF;--surface2:#FAFAF8;--surface3:#F0EFEC;--border:#E8E6E1;--border2:#D8D5CE;--muted:#A09B90;--text:#4A4640;--text2:#6E6960;--dark:#1C1A17;--blue:#2563EB;--blue-bg:#EFF6FF;--blue2:#1D4ED8;--green:#059669;--green-bg:#ECFDF5;--green2:#047857;--orange:#D97706;--orange-bg:#FFFBEB;--red:#DC2626;--red-bg:#FEF2F2;--purple:#7C3AED;--purple-bg:#F5F3FF;--teal:#0D9488;--teal-bg:#F0FDFA;--sw:250px}
html{font-size:14px}body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overflow-x:hidden}.mono{font-family:'JetBrains Mono',monospace}::selection{background:var(--teal);color:#fff}
#toasts{position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{padding:12px 18px;border-radius:8px;font:600 13px 'DM Sans',sans-serif;color:#fff;box-shadow:0 8px 24px rgba(0,0,0,.15);animation:toastIn .3s ease-out;pointer-events:auto;max-width:360px}
.toast.ok{background:#059669}.toast.info{background:#2563EB}.toast.warn{background:#D97706}.toast.err{background:#DC2626}
@keyframes toastIn{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:none}}
@keyframes toastOut{to{opacity:0;transform:translateX(30px)}}
#rgpd{position:fixed;bottom:0;left:0;right:0;z-index:9998;background:#111;color:#ccc;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;gap:16px;font-size:12px;line-height:1.5;box-shadow:0 -4px 20px rgba(0,0,0,.15)}#rgpd.hidden{display:none}#rgpd a{color:var(--teal);text-decoration:underline;cursor:pointer}#rgpd .btns{display:flex;gap:8px;flex-shrink:0}#rgpd .btns button{padding:8px 16px;border-radius:6px;border:none;font:600 12px 'DM Sans',sans-serif;cursor:pointer}#rgpd .accept{background:var(--green);color:#fff}#rgpd .refuse{background:#333;color:#ccc}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9997;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s}.modal-overlay.show{opacity:1;pointer-events:auto}.modal{background:var(--surface);border-radius:12px;max-width:640px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}.modal-head{padding:18px 22px;border-bottom:1px solid var(--border);font-size:15px;font-weight:800;color:var(--dark);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--surface);z-index:1}.modal-head .close{width:28px;height:28px;border-radius:6px;border:none;background:var(--surface3);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}.modal-body{padding:22px;font-size:13px;line-height:1.7;color:var(--text)}.modal-body h4{font-size:14px;font-weight:700;color:var(--dark);margin:16px 0 6px}.modal-body h4:first-child{margin-top:0}
.sidebar{position:fixed;top:0;left:0;bottom:0;width:var(--sw);background:#0C1222;display:flex;flex-direction:column;z-index:50;transition:transform .25s}.sb-brand{padding:22px 20px;display:flex;align-items:center;gap:10px;border-bottom:1px solid #1A2340}.sb-brand .dot{width:9px;height:9px;border-radius:50%;background:linear-gradient(135deg,#0D9488,#2563EB)}.sb-brand span{font-weight:800;font-size:16px;color:#fff;letter-spacing:-.3px}.sb-brand .tag{font-size:9px;font-weight:700;background:var(--teal);color:#fff;padding:2px 6px;border-radius:3px;margin-left:auto;text-transform:uppercase;letter-spacing:.5px}
.sb-nav{flex:1;padding:14px 10px;display:flex;flex-direction:column;gap:1px;overflow-y:auto}.sb-item{display:flex;align-items:center;gap:11px;padding:10px 12px;border-radius:8px;font-size:13px;font-weight:500;color:#7788AA;cursor:pointer;transition:all .15s;position:relative;user-select:none}.sb-item:hover{background:#141E36;color:#99AACC}.sb-item.active{background:rgba(13,148,136,.15);color:#5EEAD4}.sb-item .ico{font-size:16px;width:20px;text-align:center;flex-shrink:0}.sb-item .pill{position:absolute;right:10px;min-width:18px;text-align:center;padding:1px 6px;border-radius:10px;font-size:10px;font-weight:700}.sb-item .pill.red{background:#DC2626;color:#fff}.sb-item .pill.tl{background:var(--teal);color:#fff;font-size:8px;text-transform:uppercase;letter-spacing:.5px}.sb-sep{height:1px;background:#1A2340;margin:8px 4px}
.sb-help{margin:0 10px 8px;padding:10px 12px;border-radius:8px;background:#141E36;display:flex;align-items:center;gap:8px;font-size:12px;color:var(--teal);font-weight:600;cursor:pointer;transition:background .15s}.sb-help:hover{background:#1A2844}
.sb-user{padding:14px;border-top:1px solid #1A2340;display:flex;align-items:center;gap:10px}.sb-avatar{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,#0D9488,#2563EB);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#fff;flex-shrink:0}.sb-user .name{font-size:12px;font-weight:700;color:#ddd}.sb-user .sub{font-size:10px;color:#556688;margin-top:1px}
.burger{display:none;width:36px;height:36px;border-radius:8px;border:1px solid var(--border);background:var(--surface);cursor:pointer;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:45;opacity:0;pointer-events:none;transition:opacity .2s}.overlay.show{opacity:1;pointer-events:auto}
.main{margin-left:var(--sw);min-height:100vh;display:flex;flex-direction:column}.topbar{position:sticky;top:0;z-index:40;background:rgba(247,247,245,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0 28px;height:56px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.topbar-left{display:flex;align-items:center;gap:10px}.topbar-left h1{font-size:16px;font-weight:800;color:var(--dark);letter-spacing:-.3px}.topbar-right{display:flex;align-items:center;gap:10px}.tb-time{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace}.tb-btn{padding:7px 14px;border-radius:7px;font:600 12px 'DM Sans',sans-serif;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text);transition:all .15s}.tb-btn:hover{border-color:var(--teal);color:var(--teal)}.tb-btn.primary{background:var(--teal);color:#fff;border-color:var(--teal)}.tb-btn.primary:hover{background:#0F766E}.tb-btn.danger{color:var(--red);border-color:var(--red)}.tb-btn:disabled{opacity:.4;cursor:not-allowed}.content{padding:24px 28px;flex:1}.pg{display:none;animation:fadeUp .25s ease-out}.pg.active{display:block}@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.bdg{display:inline-flex;align-items:center;padding:3px 8px;border-radius:5px;font-size:11px;font-weight:600;gap:4px}.bdg-blue{background:var(--blue-bg);color:var(--blue)}.bdg-green{background:var(--green-bg);color:var(--green)}.bdg-orange{background:var(--orange-bg);color:var(--orange)}.bdg-red{background:var(--red-bg);color:var(--red)}.bdg-purple{background:var(--purple-bg);color:var(--purple)}.bdg-teal{background:var(--teal-bg);color:var(--teal)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:10px}.card-hd{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}.card-hd h3{font-size:13px;font-weight:700;color:var(--dark)}.card-bd{padding:16px 18px}
.chip{display:inline-flex;align-items:center;gap:5px;padding:6px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--text2)}.chip strong{font-weight:700;color:var(--dark)}
.row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}.row:last-of-type{border:none}.row .k{color:var(--text2)}.row .v{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--dark)}
.fg{display:flex;flex-direction:column;gap:4px}.fg.full{grid-column:1/-1}.fg label{font-size:11px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.3px}.fg input,.fg select,.fg textarea{padding:9px 12px;border:1.5px solid var(--border);border-radius:7px;font:400 13px 'DM Sans',sans-serif;color:var(--dark);background:var(--surface2);outline:none;transition:border .2s}.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--teal);background:#fff}.fg input.err{border-color:var(--red);background:var(--red-bg)}.fg textarea{min-height:56px;resize:vertical}.empty{text-align:center;padding:40px;color:var(--muted);font-size:13px}
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px}.kpi{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px;transition:box-shadow .2s}.kpi:hover{box-shadow:0 4px 16px rgba(0,0,0,.04)}.kpi .label{font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}.kpi .val{font-size:26px;font-weight:900;color:var(--dark);font-family:'JetBrains Mono',monospace;line-height:1}.kpi .delta{font-size:11px;font-weight:600;margin-top:6px;display:flex;align-items:center;gap:3px}.kpi .delta.up{color:var(--green)}.kpi .delta.dn{color:var(--red)}
.dash-cols{display:grid;grid-template-columns:5fr 3fr;gap:16px}.act{padding:12px 18px;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:flex-start}.act:last-child{border:none}.act-ico{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}.act-txt{font-size:12px;color:var(--text);line-height:1.5}.act-txt strong{font-weight:700;color:var(--dark)}.act-time{font-size:10px;color:var(--muted);margin-top:2px}
.post-form{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:22px}.post-form h3{font-size:15px;font-weight:800;color:var(--dark);margin-bottom:2px}.post-form .desc{font-size:12px;color:var(--muted);margin-bottom:18px}.post-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}.post-footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center}.post-preview{margin-top:20px;display:none}.post-preview.show{display:block}
.mtab{padding:6px 14px;border-radius:100px;font:500 12px 'DM Sans',sans-serif;border:1.5px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer;transition:all .15s;display:inline-block;margin:0 3px 8px}.mtab:hover{border-color:var(--teal);color:var(--teal)}.mtab.on{background:var(--teal);color:#fff;border-color:var(--teal)}
.mcard{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px;margin-bottom:12px;transition:all .2s;border-left:3px solid transparent}.mcard:hover{box-shadow:0 4px 20px rgba(0,0,0,.05)}.mcard.pending{border-left-color:var(--orange)}.mcard.active{border-left-color:var(--teal)}.mcard.done{border-left-color:var(--green);opacity:.75}.mcard-r1{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;gap:6px}.mcard-route{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:800;color:var(--dark)}.mcard-chips{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}.mcard-bot{display:flex;justify-content:space-between;align-items:center;padding-top:14px;border-top:1px solid var(--border);flex-wrap:wrap;gap:10px}.mcard-price{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:900;color:var(--dark)}.mcard-sub{font-size:10px;color:var(--muted);margin-top:2px}.mcard-btns{display:flex;gap:6px;flex-wrap:wrap}
.ob{padding:8px 16px;border-radius:7px;font:600 12px 'DM Sans',sans-serif;border:none;cursor:pointer;transition:all .15s}.ob.teal{background:var(--teal);color:#fff}.ob.teal:hover{background:#0F766E}.ob.ghost{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}.ob.ghost:hover{border-color:var(--teal);color:var(--teal)}.ob.red{background:var(--red-bg);color:var(--red)}.ob.red:hover{background:#fee}.ob:disabled{opacity:.4;cursor:not-allowed}
.resp{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px;margin-bottom:10px;transition:all .2s}.resp:hover{box-shadow:0 4px 16px rgba(0,0,0,.04)}.resp.accepted{border-color:var(--green);background:var(--green-bg)}.resp-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.resp-name{font-weight:800;font-size:14px;color:var(--dark)}.resp-meta{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;font-size:12px;color:var(--text2)}.resp-meta span{display:flex;align-items:center;gap:3px}.resp-msg{background:var(--surface2);border-radius:6px;padding:10px 12px;font-size:12px;color:var(--text);line-height:1.5;margin-bottom:10px}
.tcard{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px;margin-bottom:12px;display:flex;gap:16px;align-items:flex-start;transition:all .2s}.tcard:hover{box-shadow:0 4px 16px rgba(0,0,0,.04);border-color:var(--teal)}.tcard-av{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#0D9488,#2563EB);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;color:#fff;flex-shrink:0}.tcard-info{flex:1;min-width:0}.tcard-name{font-weight:800;font-size:15px;color:var(--dark);margin-bottom:2px}.tcard-loc{font-size:12px;color:var(--muted);margin-bottom:8px}.tcard-stats{display:flex;gap:6px;flex-wrap:wrap}.tstat{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text2);background:var(--surface2);padding:4px 8px;border-radius:4px}.tstat strong{color:var(--dark);font-weight:700}.tcard-right{display:flex;flex-direction:column;align-items:flex-end;gap:6px;flex-shrink:0}.tcard-score{font-family:'JetBrains Mono',monospace;font-weight:900;font-size:22px;color:var(--teal)}.tcard-slab{font-size:10px;color:var(--muted)}
.track-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:16px}.track-map{height:160px;background:linear-gradient(135deg,#E0F2FE 0%,#F0FDFA 50%,#ECFDF5 100%);display:flex;align-items:center;justify-content:center;position:relative}.track-route{display:flex;align-items:center;gap:12px;font-size:14px;font-weight:700;color:var(--dark)}.track-dot{width:14px;height:14px;border-radius:50%;border:3px solid var(--teal);background:#fff}.track-dot.active{background:var(--teal);animation:pulse 2s infinite}.track-line{width:80px;height:3px;background:var(--border);border-radius:2px}.track-line .fill{height:100%;background:var(--teal);border-radius:2px;transition:width .5s}@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(13,148,136,.3)}50%{box-shadow:0 0 0 8px rgba(13,148,136,0)}}.track-body{padding:18px}.track-steps{display:flex;justify-content:space-between;margin-bottom:16px}.track-step{text-align:center;flex:1}.track-step .ico{font-size:22px;margin-bottom:4px}.track-step .lbl{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}.track-step .time{font-size:11px;font-weight:600;color:var(--dark);font-family:'JetBrains Mono',monospace;margin-top:2px}.track-step.done .lbl{color:var(--green)}.track-step.now .lbl{color:var(--teal)}
.prof-hd{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px;display:flex;align-items:center;gap:16px;margin-bottom:20px}.prof-av{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#0D9488,#2563EB);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:900;color:#fff;flex-shrink:0}.prof-info h2{font-size:18px;font-weight:900;color:var(--dark)}.prof-meta{display:flex;gap:14px;margin-top:4px;flex-wrap:wrap}.prof-meta span{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:4px}.prof-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:1024px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:none}.main{margin-left:0}.burger{display:flex}.kpi-row{grid-template-columns:1fr 1fr}.dash-cols,.prof-grid{grid-template-columns:1fr}.post-grid{grid-template-columns:1fr 1fr}.content{padding:20px 16px}.topbar{padding:0 16px}}
@media(max-width:480px){.kpi-row,.post-grid{grid-template-columns:1fr}.mcard-bot{flex-direction:column;align-items:flex-start}.tcard{flex-direction:column}}
</style>
</head>
<body>
<script>
const API = window.location.origin + '/api';
const token = localStorage.getItem('fn_token');
const user = JSON.parse(localStorage.getItem('fn_user') || 'null');
if (!token || !user) { window.location.href = '/app.html'; }
if (user && user.role !== 'CHARGEUR' && user.role !== 'SUPER_ADMIN') { window.location.href = '/transporteur.html'; }
document.addEventListener('DOMContentLoaded', () => {
  const initials = ((user?.firstName?.[0] || '') + (user?.lastName?.[0] || '')).toUpperCase() || 'FN';
  document.querySelectorAll('.sb-avatar').forEach(el => el.textContent = initials);
  const nameEl = document.querySelector('.sb-user .name');
  const subEl = document.querySelector('.sb-user .sub');
  if (nameEl) nameEl.textContent = user?.firstName + ' ' + user?.lastName;
  if (subEl) subEl.textContent = user?.email || '';
});
function logout() {
  localStorage.removeItem('fn_token');
  localStorage.removeItem('fn_user');
  localStorage.removeItem('fn_refresh');
  window.location.href = '/app.html';
}
</script>
<div id="toasts"></div>
<div id="rgpd"><div>üîí FRETNOW utilise des cookies strictement n√©cessaires. Aucune donn√©e partag√©e avec des tiers. <a onclick="showModal('privacy')">Politique de confidentialit√©</a></div><div class="btns"><button class="refuse" onclick="rgpdChoice('refuse')">Refuser</button><button class="accept" onclick="rgpdChoice('accept')">Accepter</button></div></div>
<div class="modal-overlay" id="modal-privacy"><div class="modal"><div class="modal-head">üîí Politique de confidentialit√© FRETNOW <button class="close" onclick="hideModal('privacy')">‚úï</button></div><div class="modal-body"><h4>1. Responsable du traitement</h4>FRETNOW AGI, OBNF en cours d'immatriculation. Paris, France. DPO : dpo@fretnow.com<h4>2. Donn√©es collect√©es</h4>Identification professionnelle : SIREN/SIRET, raison sociale. Contact : nom, email, t√©l√©phone. Missions : origines, destinations, marchandises, volumes. Documents : Kbis, assurance marchandise, CGV.<h4>3. Base l√©gale</h4>Ex√©cution du contrat (Art. 6.1.b RGPD). Int√©r√™t l√©gitime (Art. 6.1.f). Obligation l√©gale (Art. 6.1.c) pour documents de transport.<h4>4. Destinataires</h4>√âquipes FRETNOW habilit√©es. Profil chargeur visible par transporteurs pour mise en relation. Aucune donn√©e vendue.<h4>5. Dur√©e de conservation</h4>Compte : dur√©e contractuelle + 3 ans. Documents : validit√© + 1 an. Missions : 5 ans. Factures : 10 ans. Logs : 12 mois.<h4>6. S√©curit√©</h4>TLS en transit. AES-256 au repos. Acc√®s par r√¥le. H√©bergement France.<h4>7. Vos droits</h4>Acc√®s, rectification, effacement, limitation, portabilit√©, opposition. Contact : dpo@fretnow.com. D√©lai : 30j. CNIL : www.cnil.fr<h4>8. Cookies</h4>Strictement n√©cessaires uniquement. Aucun tracking.<h4>9. Transferts hors UE</h4>Aucun.<h4>10. Mise √† jour</h4>20 f√©vrier 2026.</div></div></div>
<div class="modal-overlay" id="modal-transporter"><div class="modal"><div class="modal-head">üöõ D√©tails transporteur <button class="close" onclick="hideModal('transporter')">‚úï</button></div><div class="modal-body" id="transporter-body"></div></div></div>
<div class="modal-overlay" id="modal-responses"><div class="modal" style="max-width:720px"><div class="modal-head"><span id="resp-title">üì® R√©ponses</span><button class="close" onclick="hideModal('responses')">‚úï</button></div><div class="modal-body" id="responses-body"></div></div></div>
<div class="overlay" id="mob-overlay" onclick="toggleMenu()"></div>
<aside class="sidebar" id="sidebar"><div class="sb-brand"><svg width="28" height="28" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="44" height="44" rx="11" fill="url(#lg2)"/><path d="M10 28h6V18h10l6 6v4h4a3 3 0 010 6h-2a4 4 0 01-8 0h-8a4 4 0 01-8 0z" fill="rgba(255,255,255,.95)"/><circle cx="18" cy="34" r="2.5" fill="url(#lg2)"/><circle cx="30" cy="34" r="2.5" fill="url(#lg2)"/><rect x="8" y="16" width="6" height="1.5" rx=".75" fill="rgba(255,255,255,.5)"/><rect x="6" y="20" width="8" height="1.5" rx=".75" fill="rgba(255,255,255,.4)"/><defs><linearGradient id="lg2" x1="0" y1="0" x2="44" y2="44" gradientUnits="userSpaceOnUse"><stop stop-color="#0D9488"/><stop offset="1" stop-color="#2563EB"/></linearGradient></defs></svg><span>FRET<span style="background:linear-gradient(135deg,#0D9488,#2563EB);-webkit-background-clip:text;-webkit-text-fill-color:transparent">NOW</span></span><span class="tag">Chargeur</span></div><nav class="sb-nav"><div class="sb-item active" data-tab="dash" onclick="go('dash',this)"><span class="ico">üìä</span>Tableau de bord</div><div class="sb-item" data-tab="post" onclick="go('post',this)"><span class="ico">üì¶</span>Poster une mission</div><div class="sb-item" data-tab="missions" onclick="go('missions',this)"><span class="ico">üìã</span>Mes missions<span class="pill red" id="pill-m">3</span></div><div class="sb-item" data-tab="transporteurs" onclick="go('transporteurs',this)"><span class="ico">üöõ</span>Transporteurs<span class="pill tl">12</span></div><div class="sb-item" data-tab="tracking" onclick="go('tracking',this)"><span class="ico">üìç</span>Suivi en direct</div><div class="sb-sep"></div><div class="sb-item" data-tab="profile" onclick="go('profile',this)"><span class="ico">üë§</span>Mon profil</div></nav><div class="sb-help" onclick="toast('Support chat disponible 8h-20h','info')">üí¨ Aide & support</div><div class="sb-user"><div class="sb-avatar">AB</div><div><div class="name">AGROBON SAS</div><div class="sub">Antoine Berger ¬∑ IDF</div></div></div>
<div class="sb-help" onclick="logout()" style="background:#2a0505;color:#ef4444;cursor:pointer">üö™ D√©connexion</div>
</aside>
<main class="main">
<div class="pg active" id="pg-dash"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üìä Tableau de bord</h1></div><div class="topbar-right"><span class="tb-time" id="clock"></span><button class="tb-btn primary" onclick="goTo('post')">+ Nouvelle mission</button></div></div><div class="content"><div class="kpi-row"><div class="kpi"><div class="label">Missions ce mois</div><div class="val">7</div><div class="delta up">‚Üë +2 vs mois dernier</div></div><div class="kpi"><div class="label">R√©ponses re√ßues</div><div class="val">18</div><div class="delta up">Moy. 2.6 / mission</div></div><div class="kpi"><div class="label">En cours</div><div class="val" style="color:var(--teal)">2</div><div class="delta up">‚Üë En temps</div></div><div class="kpi"><div class="label">D√©pens√© ce mois</div><div class="val">8 420‚Ç¨</div><div class="delta dn">‚Üì -12% vs budget</div></div></div><div class="dash-cols"><div class="card"><div class="card-hd"><h3>Activit√© r√©cente</h3><span class="bdg bdg-teal">Aujourd'hui</span></div><div class="card-bd" style="padding:0" id="activity-feed"><div class="act"><div class="act-ico" style="background:var(--teal-bg)">üöõ</div><div><div class="act-txt">Transport accept√© ‚Äî <strong>FRETNOW</strong> pour Rungis ‚Üí Lyon</div><div class="act-time">Il y a 25 min</div></div></div><div class="act"><div class="act-ico" style="background:var(--blue-bg)">üì®</div><div><div class="act-txt"><strong>3 r√©ponses</strong> pour Paris ‚Üí Bordeaux</div><div class="act-time">Il y a 1h</div></div></div><div class="act"><div class="act-ico" style="background:var(--green-bg)">‚úÖ</div><div><div class="act-txt">Livraison confirm√©e ‚Äî <strong>Lille ‚Üí Paris</strong></div><div class="act-time">Hier 14:30</div></div></div><div class="act"><div class="act-ico" style="background:var(--orange-bg)">üì¶</div><div><div class="act-txt">Mission publi√©e ‚Äî <strong>Marseille ‚Üí Paris</strong> ¬∑ 20 pal.</div><div class="act-time">Hier 10:00</div></div></div></div></div><div class="card"><div class="card-hd"><h3>√âconomies r√©alis√©es</h3><span class="bdg bdg-green">Ce mois</span></div><div class="card-bd"><div style="text-align:center;padding:16px 0"><div style="font-size:36px;font-weight:900;color:var(--green);font-family:'JetBrains Mono',monospace">-12%</div><div style="font-size:12px;color:var(--muted);margin-top:4px">vs prix moyen du march√©</div></div><div class="row"><span class="k">Budget</span><span class="v">9 500‚Ç¨</span></div><div class="row"><span class="k">D√©pens√©</span><span class="v">8 420‚Ç¨</span></div><div class="row"><span class="k">√âconomie</span><span class="v" style="color:var(--green)">1 080‚Ç¨</span></div><div class="row"><span class="k">‚Ç¨/km moyen</span><span class="v">1,42‚Ç¨</span></div><div style="margin-top:10px;padding:8px;background:var(--teal-bg);border-radius:6px;font-size:11px;color:var(--teal);text-align:center;font-weight:500">üí° FRETNOW fait jouer la concurrence pour vous</div></div></div></div></div></div>
<div class="pg" id="pg-post"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üì¶ Poster une mission</h1></div><div class="topbar-right"><span class="bdg bdg-teal">R√©ponse moy. 45 min</span></div></div><div class="content"><div class="post-form"><h3>üì§ Nouvelle demande de transport</h3><div class="desc">D√©crivez votre besoin ‚Äî les transporteurs v√©rifi√©s recevront une notification.</div><div class="post-grid"><div class="fg"><label>D√©part *</label><input id="p-from" placeholder="Adresse ou ville"></div><div class="fg"><label>Arriv√©e *</label><input id="p-to" placeholder="Adresse ou ville"></div><div class="fg"><label>Date *</label><input type="date" id="p-date"></div><div class="fg"><label>V√©hicule</label><select id="p-vehicle"><option value="">Peu importe</option><option>Semi tautliner</option><option>Semi frigo</option><option>Porteur 12T</option><option>Fourgon 3.5T</option><option>Benne</option><option>Citerne</option></select></div><div class="fg"><label>Marchandise *</label><input id="p-cargo" placeholder="18 palettes, 15T..."></div><div class="fg"><label>Budget max (‚Ç¨ HT)</label><input type="number" id="p-budget" placeholder="1200" min="50"></div><div class="fg"><label>Horaire chargement</label><input type="time" id="p-time"></div><div class="fg"><label>Conditions</label><select id="p-cond"><option>Standard</option><option>Temp√©rature dirig√©e</option><option>ADR mati√®res dangereuses</option><option>Hayon requis</option></select></div><div class="fg"><label>Livraison avant</label><input type="time" id="p-timeto"></div><div class="fg full"><label>Instructions</label><textarea id="p-notes" placeholder="Contact sur place, contraintes..."></textarea></div></div><div class="post-footer"><div class="post-est">Estimation march√© : <strong id="post-est">‚Äî</strong></div><div style="display:flex;gap:8px"><button class="tb-btn" onclick="previewMission()">üëÅÔ∏è Aper√ßu</button><button class="tb-btn primary" onclick="postMission()">üì§ Publier</button></div></div></div><div class="post-preview" id="post-preview"></div></div></div>
<div class="pg" id="pg-missions"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üìã Mes missions</h1></div><div class="topbar-right"><span class="bdg bdg-teal" id="m-count">7</span></div></div><div class="content"><div id="m-tabs"></div><div id="m-list"></div></div></div>
<div class="pg" id="pg-transporteurs"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üöõ Transporteurs v√©rifi√©s</h1></div><div class="topbar-right"><span class="bdg bdg-green">12 dans votre zone</span></div></div><div class="content"><div style="display:flex;gap:10px;margin-bottom:18px;flex-wrap:wrap"><div class="fg" style="flex:1;min-width:180px"><input id="t-search" placeholder="üîç Rechercher..." oninput="renderT()"></div><div class="fg" style="width:150px"><select id="t-type" onchange="renderT()"><option value="">Tous v√©hicules</option><option>Semi</option><option>Porteur</option><option>Fourgon</option><option>Frigo</option></select></div><div class="fg" style="width:130px"><select id="t-sort" onchange="renderT()"><option value="score">Meilleur score</option><option value="missions">Plus de missions</option><option value="name">A-Z</option></select></div></div><div id="t-list"></div></div></div>
<div class="pg" id="pg-tracking"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üìç Suivi en direct</h1></div><div class="topbar-right"><span class="bdg bdg-teal" id="track-count">2 en cours</span></div></div><div class="content" id="track-content"></div></div>
<div class="pg" id="pg-profile"><div class="topbar"><div class="topbar-left"><button class="burger" onclick="toggleMenu()">‚ò∞</button><h1>üë§ Mon profil</h1></div><div class="topbar-right"><span class="bdg bdg-green">‚úÖ V√©rifi√©</span></div></div><div class="content"><div class="prof-hd"><div class="prof-av">AB</div><div class="prof-info"><h2>AGROBON SAS</h2><div class="prof-meta"><span>üè¢ 534‚Ä¢‚Ä¢‚Ä¢817</span><span>üìç Rungis (94)</span><span>üì¶ Agroalimentaire</span><span>üìä 7 missions/mois</span></div></div></div><div class="prof-grid"><div class="card"><div class="card-hd"><h3>üìä Statistiques</h3></div><div class="card-bd"><div class="row"><span class="k">Missions totales</span><span class="v">42</span></div><div class="row"><span class="k">Transporteurs utilis√©s</span><span class="v">8</span></div><div class="row"><span class="k">Note moy. donn√©e</span><span class="v">4.6/5</span></div><div class="row"><span class="k">Taux de r√©ponse</span><span class="v">94%</span></div><div class="row"><span class="k">Volume mensuel</span><span class="v">~180T</span></div></div></div><div class="card"><div class="card-hd"><h3>üìÑ Documents</h3><span class="bdg bdg-green">3/3</span></div><div class="card-bd"><div class="row"><span class="k">üè¢ Kbis</span><span class="bdg bdg-green">Valide</span></div><div class="row"><span class="k">üõ°Ô∏è Assurance marchandise</span><span class="bdg bdg-green">Valide</span></div><div class="row"><span class="k">üìã CGV Transport</span><span class="bdg bdg-green">Valide</span></div></div></div><div class="card"><div class="card-hd"><h3>üí∞ Facturation</h3></div><div class="card-bd"><div class="row"><span class="k">Janv. 2026</span><span class="v">6 780‚Ç¨</span></div><div class="row"><span class="k">F√©v. 2026</span><span class="v" style="color:var(--teal)">8 420‚Ç¨</span></div><div class="row"><span class="k">Paiement</span><span class="v">J+30</span></div><div style="border-top:1.5px solid var(--border);margin-top:6px;padding-top:8px"><div class="row"><span class="k" style="font-weight:700">Total 2026</span><span class="v" style="color:var(--teal);font-size:16px">15 200‚Ç¨</span></div></div></div></div><div class="card"><div class="card-hd"><h3>‚≠ê Transporteurs favoris</h3></div><div class="card-bd" id="fav-list"></div></div></div><div style="margin-top:20px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:10px;display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;font-weight:700;color:var(--dark)">üîí Vos donn√©es</div><div style="font-size:11px;color:var(--muted);margin-top:2px">RGPD : exportez ou supprimez vos donn√©es √† tout moment.</div></div><div style="display:flex;gap:8px"><button class="tb-btn" onclick="exportData()">üì• Exporter</button><button class="tb-btn danger" onclick="requestDeletion()">üóëÔ∏è Supprimer</button></div></div></div></div>
</main>
<script>
function esc(s){if(!s)return'';var d=document.createElement('div');d.appendChild(document.createTextNode(String(s)));return d.innerHTML}
function sanitize(s){if(!s)return'';var r=String(s).replace(/<[^>]*>/g,'');return r.replace(/</g,'\u2039').replace(/>/g,'\u203A').replace(/"/g,'\u201C').replace(/'/g,'\u2018').substring(0,500)}
function toast(m,t,d){t=t||'ok';d=d||3000;var e=document.createElement('div');e.className='toast '+t;e.textContent=m;document.getElementById('toasts').appendChild(e);setTimeout(function(){e.style.animation='toastOut .3s forwards';setTimeout(function(){e.remove()},300)},d)}
function rgpdChoice(c){try{localStorage.setItem('fn_rgpd_c',c)}catch(e){}document.getElementById('rgpd').classList.add('hidden');toast(c==='accept'?'Pr√©f√©rences enregistr√©es':'Cookies refus√©s',c==='accept'?'ok':'warn')}
(function(){try{if(localStorage.getItem('fn_rgpd_c'))document.getElementById('rgpd').classList.add('hidden')}catch(e){}})();
function showModal(id){document.getElementById('modal-'+id).classList.add('show')}
function hideModal(id){document.getElementById('modal-'+id).classList.remove('show')}
document.querySelectorAll('.modal-overlay').forEach(function(m){m.addEventListener('click',function(e){if(e.target===m)m.classList.remove('show')})});
function go(id,el){document.querySelectorAll('.pg').forEach(function(p){p.classList.remove('active')});document.getElementById('pg-'+id).classList.add('active');document.querySelectorAll('.sb-item').forEach(function(s){s.classList.remove('active')});if(el)el.classList.add('active');document.getElementById('sidebar').classList.remove('open');document.getElementById('mob-overlay').classList.remove('show')}
function goTo(id){var el=document.querySelector('.sb-item[data-tab="'+id+'"]');go(id,el)}
function toggleMenu(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('mob-overlay').classList.toggle('show')}
function tick(){var d=new Date();var el=document.getElementById('clock');if(el)el.textContent=d.toLocaleDateString('fr-FR',{weekday:'short',day:'numeric',month:'short'})+' \u00B7 '+d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})}
tick();setInterval(tick,30000);

var T=[{id:1,n:'FRETNOW',i:'TJ',l:'Paris 19e',s:4.8,m:47,f:['Semi frigo','Semi tautliner','Porteur 12T'],z:'IDF, Nord, Rh√¥ne-Alpes',v:1,fav:1},{id:2,n:'Express Route',i:'ER',l:'Gennevilliers (92)',s:4.6,m:89,f:['Semi tautliner','Semi b√¢ch√©'],z:'France enti√®re',v:1},{id:3,n:'Frigotrans',i:'FT',l:'Rungis (94)',s:4.9,m:112,f:['Semi frigo','Porteur frigo'],z:'IDF, Grand Ouest',v:1,fav:1},{id:4,n:'Nord Fret',i:'NF',l:'Lille (59)',s:4.3,m:34,f:['Semi tautliner','Benne'],z:'Hauts-de-France',v:1},{id:5,n:'M√©diterran√©e Log',i:'ML',l:'Marseille (13)',s:4.5,m:67,f:['Semi','Porteur','Fourgon'],z:'PACA, Occitanie',v:1},{id:6,n:'Karim Transport',i:'KT',l:'Lyon (69)',s:4.7,m:56,f:['Porteur 12T','Fourgon 3.5T'],z:'Rh√¥ne-Alpes',v:1,fav:1},{id:7,n:'Loire Express',i:'LE',l:'Tours (37)',s:4.2,m:23,f:['Fourgon 3.5T'],z:'Centre',v:1},{id:8,n:'Bretagne Fret',i:'BF',l:'Rennes (35)',s:4.4,m:41,f:['Semi frigo','Semi tautliner'],z:'Bretagne',v:1},{id:9,n:'Sud Fret',i:'SF',l:'Toulouse (31)',s:4.1,m:28,f:['Semi','Benne'],z:'Occitanie',v:0},{id:10,n:'Alsace Transport',i:'AT',l:'Strasbourg (67)',s:4.6,m:38,f:['Semi','Citerne'],z:'Grand Est',v:1},{id:11,n:'Normandie Log',i:'NL',l:'Rouen (76)',s:4.3,m:31,f:['Porteur 12T'],z:'Normandie',v:1},{id:12,n:'Rapid Cargo',i:'RC',l:'Orl√©ans (45)',s:4.5,m:45,f:['Semi','Fourgon 3.5T'],z:'Centre, IDF',v:1}];
var M=[{id:1,fr:'Rungis (94)',to:'Lyon (69)',dt:'Lun 24 f√©v',cg:'18 pal. ¬∑ Produits frais',vh:'Semi frigo',bg:1200,st:'active',rp:4,ac:'FRETNOW',eta:'16:30',pg:65},{id:2,fr:'Paris (75)',to:'Bordeaux (33)',dt:'Mar 25 f√©v',cg:'22T vrac',vh:'Semi b√¢ch√©',bg:1100,st:'pending',rp:3,ac:null,eta:null,pg:0},{id:3,fr:'Rungis (94)',to:'Nantes (44)',dt:'Mer 26 f√©v',cg:'8 pal. ¬∑ Surgel√©s',vh:'Semi frigo',bg:850,st:'pending',rp:1,ac:null,eta:null,pg:0},{id:4,fr:'Paris (75)',to:'Marseille (13)',dt:'Jeu 27 f√©v',cg:'20 pal. ¬∑ Sec',vh:'Semi tautliner',bg:1300,st:'pending',rp:0,ac:null,eta:null,pg:0},{id:5,fr:'Lille (59)',to:'Paris (75)',dt:'Ven 21 f√©v',cg:'12 pal. ¬∑ Boissons',vh:'Porteur 12T',bg:450,st:'done',rp:5,ac:'Nord Fret',eta:null,pg:100},{id:6,fr:'Marseille (13)',to:'Rungis (94)',dt:'Lun 17 f√©v',cg:'24 pal. ¬∑ Fruits',vh:'Semi frigo',bg:1400,st:'done',rp:6,ac:'Frigotrans',eta:null,pg:100},{id:7,fr:'Rungis (94)',to:'Strasbourg (67)',dt:'Lun 24 f√©v',cg:'14 pal. ¬∑ Laitiers',vh:'Semi frigo',bg:950,st:'active',rp:3,ac:'Alsace Transport',eta:'18:15',pg:40}];
var RD={2:[{id:1,nm:'FRETNOW',sc:4.8,fl:'Semi b√¢ch√©',ms:47,pr:980,mg:'V√©hicule dispo demain. Chargement 6h. Conducteur exp√©riment√© A10.',tm:'1h'},{id:2,nm:'Express Route',sc:4.6,fl:'Semi b√¢ch√©',ms:89,pr:1050,mg:'Disponible. Chargement + arrimage. Livraison avant 18h garantie.',tm:'2h'},{id:3,nm:'Sud Fret',sc:4.1,fl:'Semi',ms:28,pr:920,mg:'Prix serr√© mais disponible. D√©part 7h.',tm:'3h'}],3:[{id:4,nm:'Frigotrans',sc:4.9,fl:'Semi frigo',ms:112,pr:780,mg:'Sp√©cialiste surgel√©s, -18¬∞C garanti. Tra√ßabilit√© compl√®te.',tm:'4h'}]};
var mTab='all';
var favs=new Set();
try{var ff=JSON.parse(localStorage.getItem('fn_favs')||'[]');ff.forEach(function(i){favs.add(i)})}catch(e){}
T.forEach(function(t){if(t.fav)favs.add(t.id)});

var TABS=[{k:'all',l:'Toutes'},{k:'pending',l:'‚è≥ En attente'},{k:'active',l:'üöõ En cours'},{k:'done',l:'‚úÖ Termin√©es'}];
function renderMTabs(){document.getElementById('m-tabs').innerHTML=TABS.map(function(t){return '<div class="mtab '+(t.k===mTab?'on':'')+'" onclick="setMTab(\''+t.k+'\')">'+t.l+'</div>'}).join('')}
function setMTab(k){mTab=k;renderMTabs();renderM()}
function renderM(){
  var fl=mTab==='all'?M:M.filter(function(m){return m.st===mTab});
  var c=document.getElementById('m-list');
  if(!fl.length){c.innerHTML='<div class="empty">Aucune mission dans cette cat√©gorie</div>';return}
  c.innerHTML=fl.map(function(m){
    var sb='';if(m.st==='pending')sb='<span class="bdg bdg-orange">‚è≥ '+m.rp+' r√©p.</span>';else if(m.st==='active')sb='<span class="bdg bdg-teal">üöõ '+esc(m.ac)+'</span>';else sb='<span class="bdg bdg-green">‚úÖ '+esc(m.ac)+'</span>';
    return '<div class="mcard '+m.st+'"><div class="mcard-r1"><div class="mcard-route">'+esc(m.fr)+' ‚Üí '+esc(m.to)+'</div>'+sb+'</div><div class="mcard-chips"><div class="chip">üì¶ <strong>'+esc(m.cg)+'</strong></div><div class="chip">üöõ <strong>'+esc(m.vh)+'</strong></div><div class="chip">üìÖ <strong>'+esc(m.dt)+'</strong></div>'+(m.eta?'<div class="chip">üïê <strong>ETA '+esc(m.eta)+'</strong></div>':'')+'</div><div class="mcard-bot"><div><div class="mcard-price">'+m.bg.toLocaleString('fr-FR')+' ‚Ç¨</div><div class="mcard-sub">Budget max HT</div></div><div class="mcard-btns">'+(m.st==='pending'&&m.rp>0?'<button class="ob teal" onclick="viewResp('+m.id+')">üì® R√©ponses ('+m.rp+')</button>':'')+(m.st==='pending'&&m.rp===0?'<button class="ob ghost" disabled>‚è≥ En attente</button>':'')+(m.st==='active'?'<button class="ob teal" onclick="goTo(\'tracking\')">üìç Suivre</button>':'')+(m.st==='done'?'<button class="ob ghost" onclick="toast(\'Facture t√©l√©charg√©e\',\'info\')">üìÑ Facture</button>':'')+(m.st==='pending'?'<button class="ob red" onclick="cancelM('+m.id+')">‚úï Annuler</button>':'')+'</div></div></div>'
  }).join('');
  document.getElementById('m-count').textContent=fl.length+' mission'+(fl.length>1?'s':'');
}
function cancelM(id){if(!confirm('Annuler cette mission ?'))return;M=M.filter(function(m){return m.id!==id});renderM();toast('Mission annul√©e','warn');updPill()}
function updPill(){document.getElementById('pill-m').textContent=M.filter(function(m){return m.st==='pending'}).length}
function viewResp(mid){
  var m=M.find(function(x){return x.id===mid});if(!m)return;
  var rs=RD[mid]||[];
  document.getElementById('resp-title').textContent='üì® '+m.fr+' ‚Üí '+m.to;
  var b=document.getElementById('responses-body');
  if(!rs.length){b.innerHTML='<div class="empty">Aucune r√©ponse d√©taill√©e</div>';showModal('responses');return}
  b.innerHTML=rs.map(function(r){return '<div class="resp"><div class="resp-top"><div class="resp-name">'+esc(r.nm)+'</div><div style="font-family:\'JetBrains Mono\',monospace;font-weight:700;color:var(--teal)">‚≠ê '+r.sc+'</div></div><div class="resp-meta"><span>üöõ '+esc(r.fl)+'</span><span>üìä '+r.ms+' missions</span><span>üïê il y a '+esc(r.tm)+'</span></div><div class="resp-msg">'+esc(r.mg)+'</div><div style="display:flex;justify-content:space-between;align-items:center"><div style="font-family:\'JetBrains Mono\',monospace;font-size:20px;font-weight:900;color:var(--dark)">'+r.pr.toLocaleString('fr-FR')+' ‚Ç¨</div><div style="display:flex;gap:6px"><button class="ob ghost" onclick="toast(\'Message envoy√©\',\'ok\')">üí¨</button><button class="ob teal" onclick="acceptR('+mid+',\''+esc(r.nm)+'\','+r.pr+')">‚úÖ Accepter</button></div></div></div>'}).join('');
  showModal('responses');
}
function acceptR(mid,name,price){
  if(!confirm('Accepter '+name+' √† '+price+'‚Ç¨ ?'))return;
  var m=M.find(function(x){return x.id===mid});if(m){m.st='active';m.ac=name;m.pg=5;m.eta='‚Äî'}
  hideModal('responses');renderM();renderTrack();updPill();toast('Transport attribu√© √† '+name+' ‚úÖ','ok');addAct('üöõ','Transport accept√©','<strong>'+name+'</strong> ‚Äî '+esc(m.fr)+' ‚Üí '+esc(m.to));
}
function postMission(){
  var fr=document.getElementById('p-from'),to=document.getElementById('p-to'),dt=document.getElementById('p-date'),cg=document.getElementById('p-cargo'),bg=document.getElementById('p-budget');
  var ok=true;[fr,to,dt,cg].forEach(function(e){e.classList.remove('err');if(!e.value.trim()){e.classList.add('err');ok=false}});
  if(!ok){toast('Champs obligatoires manquants','err');return}
  if(bg.value&&parseFloat(bg.value)<50){bg.classList.add('err');toast('Budget min : 50‚Ç¨','err');return}
  var nm={id:Date.now(),fr:sanitize(fr.value),to:sanitize(to.value),dt:new Date(dt.value).toLocaleDateString('fr-FR',{weekday:'short',day:'numeric',month:'short'}),cg:sanitize(cg.value),vh:sanitize(document.getElementById('p-vehicle').value)||'√Ä d√©finir',bg:parseFloat(bg.value)||0,st:'pending',rp:0,ac:null,eta:null,pg:0};
  M.unshift(nm);[fr,to,dt,cg,bg,document.getElementById('p-notes')].forEach(function(e){e.value=''});
  document.getElementById('p-vehicle').selectedIndex=0;document.getElementById('p-cond').selectedIndex=0;
  document.getElementById('p-time').value='';document.getElementById('p-timeto').value='';
  document.getElementById('post-preview').classList.remove('show');
  toast('Mission publi√©e ! Transporteurs notifi√©s.','ok');addAct('üì¶','Mission publi√©e','<strong>'+nm.fr+' ‚Üí '+nm.to+'</strong>');updPill();goTo('missions');renderM();
}
function previewMission(){
  var fr=document.getElementById('p-from').value||'‚Äî',to=document.getElementById('p-to').value||'‚Äî',dt=document.getElementById('p-date').value,cg=document.getElementById('p-cargo').value||'‚Äî',vh=document.getElementById('p-vehicle').value||'Peu importe',bg=document.getElementById('p-budget').value,cd=document.getElementById('p-cond').value,nt=document.getElementById('p-notes').value;
  var ds=dt?new Date(dt).toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long'}):'‚Äî';
  var el=document.getElementById('post-preview');
  el.innerHTML='<div class="mcard pending" style="margin-top:16px"><div style="font-size:11px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px">üìã Aper√ßu</div><div class="mcard-r1"><div class="mcard-route">'+esc(fr)+' ‚Üí '+esc(to)+'</div><span class="bdg bdg-orange">Brouillon</span></div><div class="mcard-chips"><div class="chip">üì¶ <strong>'+esc(cg)+'</strong></div><div class="chip">üöõ <strong>'+esc(vh)+'</strong></div><div class="chip">üìÖ <strong>'+esc(ds)+'</strong></div>'+(cd!=='Standard'?'<div class="chip">‚ö†Ô∏è <strong>'+esc(cd)+'</strong></div>':'')+'</div>'+(bg?'<div style="font-family:\'JetBrains Mono\',monospace;font-size:20px;font-weight:900;color:var(--dark);margin-top:8px">Budget : '+parseInt(bg).toLocaleString('fr-FR')+' ‚Ç¨ HT</div>':'')+(nt?'<div style="margin-top:10px;padding:10px;background:var(--surface2);border-radius:6px;font-size:12px">'+esc(nt)+'</div>':'')+'</div>';
  el.classList.add('show');
}

function renderT(){
  var q=(document.getElementById('t-search').value||'').toLowerCase(),tp=document.getElementById('t-type').value.toLowerCase(),sr=document.getElementById('t-sort').value;
  var fl=T.filter(function(t){if(q&&t.n.toLowerCase().indexOf(q)===-1&&t.l.toLowerCase().indexOf(q)===-1)return false;if(tp&&!t.f.some(function(f){return f.toLowerCase().indexOf(tp)!==-1}))return false;return true});
  if(sr==='score')fl.sort(function(a,b){return b.s-a.s});else if(sr==='missions')fl.sort(function(a,b){return b.m-a.m});else fl.sort(function(a,b){return a.n.localeCompare(b.n)});
  var c=document.getElementById('t-list');
  if(!fl.length){c.innerHTML='<div class="empty">Aucun transporteur trouv√©</div>';return}
  c.innerHTML=fl.map(function(t){var fv=favs.has(t.id);return '<div class="tcard"><div class="tcard-av">'+esc(t.i)+'</div><div class="tcard-info"><div class="tcard-name">'+esc(t.n)+(t.v?' <span class="bdg bdg-green" style="font-size:9px">‚úÖ</span>':' <span class="bdg bdg-orange" style="font-size:9px">‚è≥</span>')+'</div><div class="tcard-loc">üìç '+esc(t.l)+' ¬∑ '+esc(t.z)+'</div><div class="tcard-stats">'+t.f.map(function(f){return '<div class="tstat">üöõ <strong>'+esc(f)+'</strong></div>'}).join('')+'<div class="tstat">üìä <strong>'+t.m+'</strong> missions</div></div></div><div class="tcard-right"><div class="tcard-score">'+t.s+'</div><div class="tcard-slab">/ 5.0</div><button class="ob '+(fv?'teal':'ghost')+'" onclick="togFav('+t.id+')" style="font-size:11px;padding:6px 10px">'+(fv?'‚≠ê Favori':'‚òÜ Ajouter')+'</button><button class="ob ghost" onclick="viewT('+t.id+')" style="font-size:11px;padding:6px 10px">Profil</button></div></div>'}).join('');
}
function togFav(id){if(favs.has(id)){favs.delete(id);toast('Retir√© des favoris','info')}else{favs.add(id);toast('Favori ajout√© ‚≠ê','ok')}try{localStorage.setItem('fn_favs',JSON.stringify(Array.from(favs)))}catch(e){}renderT();renderFavs()}
function viewT(id){
  var t=T.find(function(x){return x.id===id});if(!t)return;
  document.getElementById('transporter-body').innerHTML='<div style="display:flex;gap:16px;align-items:center;margin-bottom:20px"><div class="tcard-av" style="width:56px;height:56px;font-size:20px">'+esc(t.i)+'</div><div><div style="font-size:18px;font-weight:900;color:var(--dark)">'+esc(t.n)+'</div><div style="font-size:12px;color:var(--muted);margin-top:2px">üìç '+esc(t.l)+'</div></div><div style="margin-left:auto;text-align:right"><div style="font-family:\'JetBrains Mono\',monospace;font-size:28px;font-weight:900;color:var(--teal)">'+t.s+'</div><div style="font-size:10px;color:var(--muted)">/ 5.0 ¬∑ '+t.m+' missions</div></div></div><div class="row"><span class="k">Zones</span><span class="v" style="font-family:inherit;font-size:12px">'+esc(t.z)+'</span></div><div class="row"><span class="k">Flotte</span><span class="v" style="font-family:inherit;font-size:12px">'+t.f.map(function(f){return esc(f)}).join(', ')+'</span></div><div class="row"><span class="k">Statut</span><span class="bdg '+(t.v?'bdg-green':'bdg-orange')+'">'+(t.v?'‚úÖ V√©rifi√©':'‚è≥ En cours')+'</span></div><div style="margin-top:16px;display:flex;gap:8px"><button class="tb-btn primary" onclick="hideModal(\'transporter\');toast(\'Demande envoy√©e √† '+esc(t.n)+'\',\'ok\')" style="flex:1">üì§ Demander devis</button><button class="tb-btn" onclick="togFav('+t.id+');renderT()" style="flex:1">'+(favs.has(t.id)?'‚≠ê Favori':'‚òÜ Favori')+'</button></div>';
  showModal('transporter');
}

function renderTrack(){
  var act=M.filter(function(m){return m.st==='active'});
  document.getElementById('track-count').textContent=act.length+' en cours';
  var c=document.getElementById('track-content');
  if(!act.length){c.innerHTML='<div class="empty" style="padding:60px">üìç Aucun transport en cours</div>';return}
  c.innerHTML=act.map(function(m){
    var steps=[{i:'üì¶',l:'Chargement',d:m.pg>=10,n:m.pg>0&&m.pg<10,t:m.pg>=10?'08:15':'‚Äî'},{i:'üöõ',l:'En route',d:m.pg>=90,n:m.pg>=10&&m.pg<90,t:m.pg>=10?'08:45':'‚Äî'},{i:'üìç',l:'Arriv√©e',d:m.pg>=95,n:m.pg>=90&&m.pg<95,t:m.eta||'‚Äî'},{i:'‚úÖ',l:'Livr√©',d:m.pg>=100,n:false,t:m.pg>=100?'OK':'‚Äî'}];
    return '<div class="track-card"><div class="track-map"><div class="track-route"><div class="track-dot '+(m.pg<100?'active':'')+'"></div><span>'+esc(m.fr)+'</span><div class="track-line"><div class="fill" style="width:'+m.pg+'%"></div></div><span>'+esc(m.to)+'</span><div class="track-dot '+(m.pg>=100?'active':'')+'"></div></div></div><div class="track-body"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><div><div style="font-weight:800;color:var(--dark)">'+esc(m.ac)+'</div><div style="font-size:11px;color:var(--muted)">'+esc(m.cg)+'</div></div><div class="bdg bdg-teal">ETA '+esc(m.eta||'‚Äî')+'</div></div><div class="track-steps">'+steps.map(function(s){return '<div class="track-step '+(s.d?'done':s.n?'now':'')+'"><div class="ico">'+s.i+'</div><div class="lbl">'+s.l+'</div><div class="time">'+s.t+'</div></div>'}).join('')+'</div><div style="display:flex;gap:6px;flex-wrap:wrap"><div class="chip">üìÖ <strong>'+esc(m.dt)+'</strong></div><div class="chip">üí∂ <strong>'+m.bg.toLocaleString('fr-FR')+'‚Ç¨</strong></div>'+(m.pg>0&&m.pg<100?'<div class="chip" style="background:var(--teal-bg);border-color:var(--teal)">üìä <strong style="color:var(--teal)">'+m.pg+'%</strong></div>':'')+'</div><div style="margin-top:12px;display:flex;gap:8px"><button class="ob ghost" onclick="toast(\'Appel conducteur...\',\'info\')">üìû Appeler</button><button class="ob ghost" onclick="toast(\'Message envoy√©\',\'ok\')">üí¨ Message</button>'+(m.pg>=95?'<button class="ob teal" onclick="confirmDel('+m.id+')">‚úÖ Confirmer livraison</button>':'')+'</div></div></div>'
  }).join('');
}
function confirmDel(id){
  if(!confirm('Confirmer la r√©ception ?'))return;
  var m=M.find(function(x){return x.id===id});if(m){m.st='done';m.pg=100}
  renderTrack();renderM();toast('Livraison confirm√©e ‚úÖ','ok');addAct('‚úÖ','Livraison confirm√©e','<strong>'+esc(m.fr)+' ‚Üí '+esc(m.to)+'</strong>');
  setTimeout(function(){var n=prompt('Notez '+m.ac+' (1-5) :');if(n&&parseInt(n)>=1&&parseInt(n)<=5){toast('Note '+n+'/5 pour '+m.ac+' ‚≠ê','ok');addAct('‚≠ê','√âvaluation','<strong>'+n+'/5</strong> ‚Äî '+esc(m.ac))}},1500);
}
function addAct(ico,title,det){var f=document.getElementById('activity-feed');if(!f)return;var now=new Date();f.insertAdjacentHTML('afterbegin','<div class="act"><div class="act-ico" style="background:var(--teal-bg)">'+ico+'</div><div><div class="act-txt">'+esc(title)+' ‚Äî '+det+'</div><div class="act-time">'+now.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})+'</div></div></div>')}
function renderFavs(){var fv=T.filter(function(t){return favs.has(t.id)});var c=document.getElementById('fav-list');if(!c)return;if(!fv.length){c.innerHTML='<div class="empty" style="padding:16px">Aucun favori</div>';return}c.innerHTML=fv.map(function(t){return '<div class="row"><span class="k">‚≠ê '+esc(t.n)+' <span style="font-size:10px;color:var(--muted)">'+esc(t.l)+'</span></span><span class="v" style="color:var(--teal)">'+t.s+'</span></div>'}).join('')}
function exportData(){try{var d={company:'AGROBON SAS',siren:'534***817',missions:M.length,favorites:Array.from(favs),exportDate:new Date().toISOString()};var b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});var a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='fretnow-chargeur-'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(a.href);toast('Donn√©es export√©es üì•','ok')}catch(e){toast('Erreur: '+e.message,'err')}}
function requestDeletion(){if(!confirm('‚ö†Ô∏è Supprimer toutes vos donn√©es ?'))return;if(!confirm('Derni√®re confirmation : suppression d√©finitive ?'))return;try{localStorage.removeItem('fn_favs');localStorage.removeItem('fn_rgpd_c')}catch(e){}toast('Demande envoy√©e. Traitement sous 30j.','warn',5000)}
renderMTabs();renderM();renderT();renderTrack();renderFavs();
if(window.console){console.log('%c‚ö†Ô∏è FRETNOW SECURITY','font-size:20px;color:red;font-weight:bold');console.log('%cNe collez jamais de code ici.','font-size:14px;color:#333')}
</script>
</body>
</html>
